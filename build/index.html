<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <title>CarrotQuest API Reference</title>

    <link href="stylesheets/screen.css" rel="stylesheet" type="text/css" media="screen" />
    <link href="stylesheets/print.css" rel="stylesheet" type="text/css" media="print" />
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="javascripts/all.js" type="text/javascript"></script>

      <script>
        $(function() {
          setupLanguages(["shell"]);

          // Colorize objects description
          $('.tocify-item').each(function(index) {
            var aElem = $(this).children()
            if (aElem.text().lastIndexOf('Объект', 0) === 0) {
              aElem.css("font-style", "italic");
            }
          });

          // Colorize request defenition
          $('pre.highlight.plaintext').each(function() {
            if (/(GET|POST|PUT|DELETE).*/.test($(this).text())) {
              $(this).addClass('method-request');
              $(this).next().addClass('method-input');
              $(this).next().next().addClass('method-output');
            }
          });

          $('.object-example').each(function() {
            $(this).parent().next().addClass('object-example-code');
          });
        });
      </script>
  </head>

  <body class="index">
    <div class="tocify-wrapper">
      <img src="images/logo.png" />
        <div class="search">
          <input type="text" class="search" id="input-search">
        </div>
        <div class="search-info"></div>
      <div id="toc">
      </div>
        <ul class="toc-footer">
            <li><a href='http://github.com/tripit/slate'>Documentation Powered by Slate</a></li>
        </ul>
    </div>
    <div class="page-wrapper">
      <div class="dark-box"></div>
      <div class="content">
        <h1 id="Введение">Введение</h1>

<p>Это описание API CarrotQuest</p>

<blockquote>
<p>API enpoint:</p>
</blockquote>
<pre class="highlight plaintext">http://api.carrotquest.io/v1
</pre>

<h1 id="Формат-данных">Формат данных</h1>

<p>Все ответы отдаются в JSON. Других форматов нет и в ближайшее времени не предвидится. Каждый ответ заключен в &ldquo;конверт&rdquo;.</p>

<blockquote>
<p>Конверт</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">

  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>Есть два обязательных объекта, присутсвующих в каждом ответе: <code class="prettyprint">data</code> и <code class="prettyprint">meta</code>. Блок <code class="prettyprint">meta</code> содержит метаданные об ответе. Поле <code class="prettyprint">status</code> совпадает с HTTP кодом возврата. Блок <code class="prettyprint">data</code> содержит сам ответ.</p>

<h1 id="Стиль">Стиль</h1>

<p>API сделан в объектно-ориентированном стиле. Будем очень сильно стараться соотвествовать канонам <a href="http://ru.wikipedia.org/wiki/REST">REST API</a>.</p>

<p>Все, что начинается с символа $ - систмное имя.</p>

<p>Все параметры к запросам - необязательные, если явно не указано обратное.</p>

<p>Стиль именования переменных - under_score (стандартный для python)</p>

<h1 id="Ключи">Ключи</h1>

<p>У каждого приложения (app) есть <strong>ID</strong> (идентификатор, положительно число), 
<strong>API Key</strong> (публичный ключ, может появляться в javascript коде), <strong>API Secret</strong>
(приватный ключ, его необходимо хранить в секрете, использовать его можно только с 
серверной стороны, то есть в javascript-коде он ни в коем млучае не должен появляться)</p>

<h1 id="Авторизация">Авторизация</h1>

<p>Для того, чтобы общаться с API, необходима авторизация, чтобы знать, от чьего имени происходит запрос. Каждый запрос должен включать GET-параметр auth_token. Поддерживаются 4 типа тукенов:</p>

<table><thead>
<tr>
<th>auth_token</th>
<th>Где используется</th>
</tr>
</thead><tbody>
<tr>
<td>user.userid.apikey.token</td>
<td>Клиентский JS код на стороне приложения, но без сессии</td>
</tr>
<tr>
<td>session.js.userid.apikey</td>
<td>Клиентский JS код на стороне приложения (<strong>УСТАРЕЛ!</strong>)</td>
</tr>
<tr>
<td>app.apikey.apisecret</td>
<td>Серверный код на стороне приложения</td>
</tr>
<tr>
<td>account.userid.token</td>
<td>Личный кабинет пользователя</td>
</tr>
<tr>
<td>panel.userid.token</td>
<td>Панель администратора</td>
</tr>
<tr>
<td>global.userid.token</td>
<td>Глобальный тукен, который ложиться в куку <code class="prettyprint">carrotquest_auth_token_global</code> на домене .carrotquest.io (хорошо, если браузер юзера сохранит эту куку - тогда можно организовать тотальную слежку). Использовать напрямую его нельзя.</td>
</tr>
<tr>
<td>superuser.XXX</td>
<td><em>TODO</em></td>
</tr>
<tr>
<td>oauth.oauth</td>
<td><em>TODO</em></td>
</tr>
</tbody></table>

<p>Если в auth_token несколько &ldquo;компонентов&rdquo;, они разделены символом точки. apikey, apisecret, userid - нужно заменить на реальные данные.</p>

<p>Например, чтобы обратиться к конечной точке <code class="prettyprint">/users/USER_ID/carrots</code> с серверной стороны, нужно сделать запрос на URL <code class="prettyprint">http://api.carrotquest.io/v1/users/USER_ID/carrots?auth_token=app.XXX.YYY</code> (здесь apikey=XXX, apisecret=YYY)</p>

          <h1 id="Ошибки">Ошибки</h1>

<p>Ответы будут содержать правильные стандартные HTTP-коды:</p>

<blockquote>
<p>Примеры ошибочных ответов:</p>
</blockquote>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">403</span><span class="p">,</span><span class="w">
    </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"AuthenticationFailed"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"error_message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Invalid auth_token"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{},</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">400</span><span class="p">,</span><span class="w">
    </span><span class="s2">"error_fields"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"This field is required."</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"html"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="s2">"This field is required."</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"error"</span><span class="p">:</span><span class="w"> </span><span class="s2">"BadRequest"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"error_message"</span><span class="p">:</span><span class="w"> </span><span class="s2">"The request could not be understood by the server due to malformed syntax"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<table><thead>
<tr>
<th>Код</th>
<th>Описание</th>
</tr>
</thead><tbody>
<tr>
<td>400</td>
<td>Bad Request &ndash; Неверные запрос (пустые или неправильные аргументы)</td>
</tr>
<tr>
<td>403</td>
<td>Forbidden &ndash; Нет доступа к данному методу</td>
</tr>
<tr>
<td>404</td>
<td>Not Found &ndash; Метода не существует</td>
</tr>
<tr>
<td>405</td>
<td>Method Not Allowed &ndash; Не разрешенный метод (например, POST вместо GET)</td>
</tr>
<tr>
<td>500, 502, 503, 504</td>
<td>Internal Server Error &ndash; Что то не так с сервером</td>
</tr>
</tbody></table>

<p>В случае ошибки, объект <code class="prettyprint">data</code> будет пуст, а в объекте <code class="prettyprint">meta</code> будут содержаться поля:</p>

<table><thead>
<tr>
<th>Название</th>
<th>Описание</th>
</tr>
</thead><tbody>
<tr>
<td>status</td>
<td>HTTP-код</td>
</tr>
<tr>
<td>error</td>
<td>Название ошибки</td>
</tr>
<tr>
<td>error_message</td>
<td>Детальное описание ошибки</td>
</tr>
<tr>
<td>error_fields</td>
<td>В случае, если ошибка BadRequest, здесь будет содержаться информация об ошибках в параметрах</td>
</tr>
</tbody></table>

<p>Название ошибки (<code class="prettyprint">error</code>) специфично для каждого метода, однако, имеются 
некоторые ошибки, которые есть везде:</p>

<table><thead>
<tr>
<th>Название</th>
<th>Описание</th>
</tr>
</thead><tbody>
<tr>
<td>BadRequest</td>
<td>Неправильные или отсутствующие параметры</td>
</tr>
<tr>
<td>AuthenticationFailed</td>
<td>Отсутствующий, неверный или отозванный auth_token</td>
</tr>
<tr>
<td>InvalidAuthType</td>
<td>auth_token верный, но его нельзя использовать в методе</td>
</tr>
<tr>
<td>MethodNotAllowed</td>
<td>Неправильный HTTP-метод</td>
</tr>
</tbody></table>

<h1 id="Автопараметры">Автопараметры</h1>

<p>В некоторых случаях, когда нужно передать в качестве аргумента ID пользователя или ID приложения,
можно использовать сокращения - $self_user и $self_app соответственно.
Если auth_token связан с приложением или пользователем, то эти параметры будут заменены на ID 
&ldquo;текущего&rdquo;&ldquo; пользователя и приложения соответственно</p>

          <h1 id="auth">Auth</h1>

<h2 id="Авторизоваться-из-js-на-сайте-приложения">Авторизоваться из JS на сайте приложения</h2>
<pre class="highlight plaintext">POST http://api.carrotquest.io/v1/auth/jsconnect?auth_token=XXX
</pre>
<pre class="highlight shell">curl <span class="s2">"http://api.carrotquest.io/v1/auth/jsconnect?auth_token=XXX"</span> <span class="se">\</span>
  -d <span class="s2">"app_key=6-a832b29f610bc27d9e9a11249c6192"</span>
</pre>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"authToken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"user.3138.IHBp4Gyaa1an5UbazcZ2J1PHvtZzu6Rg.aa042afad15bf0dbfbb33d5214193369954523dfd5f97e05"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"user"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"full"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"hasAvatar"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Maks Materkov"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3138</span><span class="p">,</span><span class="w">
      </span><span class="s2">"carrots"</span><span class="p">:</span><span class="w"> </span><span class="mi">0</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="s2">"app"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"bonus"</span><span class="p">:</span><span class="w"> </span><span class="kc">false</span><span class="w">
      </span><span class="p">},</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">3</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>Функции может быть передан действительный тукен (типа <code class="prettyprint">user.XXX</code>), но может быть пустым. На сайте клиента тукен сохраняется в куке <code class="prettyprint">carrotquest_auth_token</code>, <strong><em>на домене клиента (!)</em></strong>. Наша JS библиотека при каждой загрузке странице будет смотреть, есть ли уже сохраненный тукен в куках.</p>

<p>В любом случае, функция возвращает authToken, который каждый раз заново устанавливается в куки. Возвращаемый тукен будет тем же самым (чаще всего), но может и быть другим, Например, если сначала юзер зашел на сайт клиента (выдан тукен), затем зарегался в бонусной системе (при этом установился глобальный тукен) и после этого снова вернулся на сайт. Теперь есть старый тукен (в куках на стороне клиента) и установлен глобальный (в куках на нашей стороне). В этом случае будет возвращен новый тукен, т.к. ID пользователя при регистрации изменился.</p>

<h3 id="Параметры">Параметры</h3>

<table><thead>
<tr>
<th>Название</th>
<th>Описание</th>
</tr>
</thead><tbody>
<tr>
<td>app_key</td>
<td>API Key</td>
</tr>
</tbody></table>

<h2 id="Установить-глобальный-тукен">Установить глобальный тукен</h2>
<pre class="highlight plaintext">GET http://api.carrotquest.io/v1/auth/trackglobal
</pre>
<pre class="highlight shell">curl <span class="s2">"http://api.carrotquest.io/v1/auth/trackglobal?auth_token=XXX"</span>
</pre>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>Эта функция принимает auth_token и устанавливает куку <code class="prettyprint">carrotquest_auth_token_global</code> (см. описание типов тукенов выше)</p>

<p>Вопрос - зачем нужен глобальные и &ldquo;локальные&rdquo; тукены? Оказалось, что некоторые браузеры (Сафари) не позволяют ставить куки на домены тех сайтов, которые пользователь ни разу не посещал. То есть, например, человек захдит на сайт www.ecodomshop.ru и наша система попытается установить куку, но на домене .carrotquest.io. Этот гадкий браузер не даст этого сделать! Пэтому такая морока с авторизацией и такое разнообразие типов авторизации.</p>

<h2 id="Войти-в-личный-кабинет">Войти в личный кабинет</h2>
<pre class="highlight plaintext">POST http://api.carrotquest.io/v1/auth/accountlogin
</pre>
<pre class="highlight shell">curl <span class="s2">"http://api.carrotquest.io/v1/auth/accountlogin"</span> <span class="se">\</span>
  -d <span class="s2">"email=my@email.com"</span> <span class="se">\</span>
  -d <span class="s2">"password=1234"</span>
</pre>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"authToken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account.123.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>Вход в личный кабинет. Если вход успешен, в ответе будет содержаться authToken, который нужно использовать для общения с API в личном кабинете юзера (тукен типа <code class="prettyprint">account.XXX</code>).</p>

<p>Если неправильные емейл/пароль, будет ответ 400 с ошибкой <code class="prettyprint">InvalidCredentials</code>.</p>

<h3 id="Параметры">Параметры</h3>

<table><thead>
<tr>
<th>Название</th>
<th>Описание</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>Email</td>
</tr>
<tr>
<td>password</td>
<td>Password</td>
</tr>
</tbody></table>

<h2 id="Зарегистрироваться-в-бонусной-системе">Зарегистрироваться в бонусной системе</h2>
<pre class="highlight plaintext">POST http://api.carrotquest.io/v1/auth/accountregister
</pre>

<p>Попытка регистрации пользователя в бонусной системе. Параметр - email. Если такого емейла нет, то он регистрируется (пароль высылается на почту). Если регистрация успешна, в ответе будет содержаться authToken для работы в личном кабинете (тукен типа <code class="prettyprint">account.XXX</code>)</p>

<h2 id="Войти-в-панель-администратора">Войти в панель администратора</h2>
<pre class="highlight plaintext">POST http://api.carrotquest.io/v1/auth/panellogin
</pre>
<pre class="highlight shell">curl <span class="s2">"http://api.carrotquest.io/v1/auth/panellogin?auth_token=XXX"</span> <span class="se">\</span>
  -d <span class="s2">"email=my@email.com"</span> <span class="se">\</span>
  -d <span class="s2">"password=1234"</span>
</pre>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"authToken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"panel.123.xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>Вход в панель администратора. Если вход успешен, в ответе будет содержаться authToken, который нужно использовать для общения с API в панели администратора (тукен типа <code class="prettyprint">panel.XXX</code>)</p>

<p>Если неправильные емейл/пароль, будет ответ 400 с ошибкой <code class="prettyprint">InvalidCredentials</code>.</p>

<h3 id="Параметры">Параметры</h3>

<table><thead>
<tr>
<th>Название</th>
<th>Описание</th>
</tr>
</thead><tbody>
<tr>
<td>email</td>
<td>Email</td>
</tr>
<tr>
<td>password</td>
<td>Password</td>
</tr>
</tbody></table>

<h3 id="Возвращаемое-значение">Возвращаемое значение</h3>

<p>Возвращает authToken</p>

<h2 id="Проверить-тукен">Проверить тукен</h2>
<pre class="highlight plaintext">GET http://api.carrotquest.io/v1/auth/checktoken
</pre>
<pre class="highlight shell">curl <span class="s2">"http://api.carrotquest.io/v1/auth/checktoken?auth_token=XXX"</span>
</pre>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"panel"</span><span class="p">,</span><span class="w">
    </span><span class="s2">"created"</span><span class="p">:</span><span class="w"> </span><span class="mi">1402976580</span><span class="p">,</span><span class="w">
    </span><span class="s2">"user"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
    </span><span class="s2">"app"</span><span class="p">:</span><span class="w"> </span><span class="err">null</span><span class="p">,</span><span class="w">
    </span><span class="s2">"authToken"</span><span class="p">:</span><span class="w"> </span><span class="s2">"panel.2.723b2f823d427a10adc79a02117d2d8eff6cb164ec2e8619"</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>Выдает описание тукена</p>

<h3 id="Вовзращаемое-значение">Вовзращаемое значение</h3>

<p>Возвращает информацию о переданном тукене</p>

          <h1 id="apps">Apps</h1>

<h2 id="Объект-app">Объект App</h2>

<p><span class="object-example"></span></p>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"app"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Test shop2"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"origin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"api_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e6rF5TPZhrWXETArwwXWFJ20b6rOxQHf"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"admins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="mi">2</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<table><thead>
<tr>
<th>Название</th>
<th>Описание</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>ID</td>
</tr>
<tr>
<td>name</td>
<td>Имя приложения. Должно быть уникальным.</td>
</tr>
<tr>
<td>origin</td>
<td>Адрес приложения</td>
</tr>
<tr>
<td>api_key</td>
<td>API Key</td>
</tr>
<tr>
<td>admins</td>
<td>Массив, ID пользователей, которым разрешен доступ к панели администратора этого рпиложения</td>
</tr>
</tbody></table>

<h2 id="Объект-app-(расширенный)">Объект App (расширенный)</h2>

<p><span class="object-example"></span></p>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"app"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Test shop2"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"origin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.com"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"api_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e6rF5TPZhrWX2TArwvXWFJ20b6r3xQHf"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"api_secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lvM9T5pm14WGOzvYyHc5ZCMtwss7apZ4H9i2LNeoyw3KbI6J5BcHlhDfCpeIpBN8"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"admins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="mi">2</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"maxDiscount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.05"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"convertedPercent"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.3"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"bonus"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="s2">"bonus_account"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="s2">"bonusLanding"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://example.com/"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<table><thead>
<tr>
<th>Название</th>
<th>Описание</th>
</tr>
</thead><tbody>
<tr>
<td>id</td>
<td>ID</td>
</tr>
<tr>
<td>name</td>
<td>Имя приложения. Должно быть уникальным.</td>
</tr>
<tr>
<td>origin</td>
<td>Адрес приложения</td>
</tr>
<tr>
<td>api_key</td>
<td>API Key</td>
</tr>
<tr>
<td>api_secret</td>
<td>API Secret</td>
</tr>
<tr>
<td>admins</td>
<td>Массив, ID пользователей, которым разрешен доступ к панели администратора этого рпиложения</td>
</tr>
<tr>
<td>settings.max_discount</td>
<td>Максимальный процент скидки</td>
</tr>
<tr>
<td>settings.converted_percent</td>
<td>Процент от цены, который конвертируется в морковки</td>
</tr>
<tr>
<td>settings.bonus</td>
<td>Включена ли бонусная система</td>
</tr>
<tr>
<td>settings.bonus_landing</td>
<td>Стрнаица, на которую ведут реккомендации</td>
</tr>
</tbody></table>

<h2 id="Получить-информацию-о-приложении">Получить информацию о приложении</h2>
<pre class="highlight plaintext">GET http://api.carrotquest.io/v1/apps/{APP_ID}
</pre>
<pre class="highlight shell">curl <span class="s2">"http://api.carrotquest.io/v1/apps/5?auth_token=XXX"</span>
</pre>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"app"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">5</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"EcoDom"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"origin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://www.ecodomshop.ru"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"api_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"9aZIEqDHAjhMi0wHoD8udndOyJSFGZkg"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"admins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="mi">273</span><span class="p">,</span><span class="w">
        </span><span class="mi">147</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>Выдает базовую, общедоступную информацию о приложении.</p>

<h3 id="Возаращаемое-значение">Возаращаемое значение</h3>

<p>Возвращает <a href="#Объект-app">базовый объект App</a></p>

<h2 id="Получить-расширенную-информацию-о-приложении">Получить расширенную информацию о приложении</h2>
<pre class="highlight plaintext">GET http://api.carrotquest.io/v1/apps/{APP_ID}/extendedinfo
</pre>
<pre class="highlight shell">curl <span class="s2">"http://api.carrotquest.io/v1/apps/5/extendedinfo?auth_token=XXX"</span>
</pre>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"app"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Test shop2"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"origin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"api_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e6rF5TPchrWXE5ArwwXWFJ20b6rOxQHf"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"api_secret"</span><span class="p">:</span><span class="w"> </span><span class="s2">"lvM9T5pm14WGvzvYyHm5ZCjtwss7apZ4W9i1LNeoywwKbI6J5BcHdhDfCpeIpBN8"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"admins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="mi">1</span><span class="p">,</span><span class="w">
        </span><span class="mi">2</span><span class="w">
      </span><span class="p">],</span><span class="w">
      </span><span class="s2">"settings"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="s2">"max_discount"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.05"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"converted_percent"</span><span class="p">:</span><span class="w"> </span><span class="s2">"0.3"</span><span class="p">,</span><span class="w">
        </span><span class="s2">"bonus"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="p">,</span><span class="w">
        </span><span class="s2">"bonus_account"</span><span class="p">:</span><span class="w"> </span><span class="s2">""</span><span class="p">,</span><span class="w">
        </span><span class="s2">"bonus_landing"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080/"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>Выдает расширенную информацию о приложении.</p>

<h3 id="Возаращаемое-значение">Возаращаемое значение</h3>

<p>Возвращает <a href="#Объект-app-(расширенный)">расширенный объект App</a></p>

<h2 id="Создать-приложение">Создать приложение</h2>
<pre class="highlight plaintext">POST http://api.carrotquest.io/v1/apps
</pre>
<pre class="highlight shell">curl <span class="s2">"http://api.carrotquest.io/v1/apps?auth_token=XXX"</span> <span class="se">\</span>
  -d <span class="s2">"name=My super app"</span>
  -d <span class="s2">"origin=http://mydomain.ru"</span>
</pre>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"app"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="s2">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">2</span><span class="p">,</span><span class="w">
      </span><span class="s2">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Test shop2"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"origin"</span><span class="p">:</span><span class="w"> </span><span class="s2">"http://localhost:8080"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"api_key"</span><span class="p">:</span><span class="w"> </span><span class="s2">"e6rF5TPchrWXE5ArwwXWFJ20b6rOxQHf"</span><span class="p">,</span><span class="w">
      </span><span class="s2">"admins"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="mi">3</span><span class="w">
      </span><span class="p">]</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>Создает новое приложение</p>

<h3 id="Параметры">Параметры</h3>

<table><thead>
<tr>
<th>Название</th>
<th>Описание</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td><strong>обязательный</strong> Название приложения</td>
</tr>
<tr>
<td>origin</td>
<td>Адрес приложения</td>
</tr>
</tbody></table>

<h3 id="Возаращаемое-значение">Возаращаемое значение</h3>

<p>Если приложение создано успешно, возвращает <a href="#Объект-app">базовый объект App</a>.</p>

<p>Если имя не уникально, возвращатся ошибка <code class="prettyprint">AppNameDuplicate</code> (статус 400)</p>

<h2 id="Обновить-приложение">Обновить приложение</h2>
<pre class="highlight plaintext">PUT http://api.carrotquest.io/v1/apps/{APP_ID}
</pre>
<pre class="highlight shell">curl <span class="s2">"http://api.carrotquest.io/v1/apps/5?auth_token=XXX&amp;name=MySuperApp"</span>
  -X PUT
  -d <span class="nv">origin</span><span class="o">=</span>http://example.com
  -d <span class="s2">"name=My name"</span>
  -d <span class="nv">converted_percent</span><span class="o">=</span>0.05
  -d <span class="nv">max_discount</span><span class="o">=</span>0.10
  -d <span class="nv">bonus</span><span class="o">=</span><span class="nb">true</span>
  -d <span class="s2">"bonus_landing=http://example.com/some_page.php"</span>
</pre>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>Обновляет информацию о приложении</p>

<h3 id="Параметры">Параметры</h3>

<table><thead>
<tr>
<th>Название</th>
<th>Описание</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td><strong>обязательный</strong> Название приложения</td>
</tr>
<tr>
<td>origin</td>
<td><strong>обязательный</strong> Адрес приложения</td>
</tr>
<tr>
<td>max_discount</td>
<td><strong>обязательный</strong> Максимальный процент скидки</td>
</tr>
<tr>
<td>converted_percent</td>
<td><strong>обязательный</strong> Процент от цены, который конвертируется в морковки</td>
</tr>
<tr>
<td>bonus</td>
<td><strong>обязательный</strong> Включена ли бонусная система</td>
</tr>
<tr>
<td>bonus_landing</td>
<td><strong>обязательный</strong> Стрнаица, на которую ведут реккомендации</td>
</tr>
</tbody></table>

<h2 id="Проверить-занятость-имени">Проверить занятость имени</h2>
<pre class="highlight plaintext">GET http://api.carrotquest.io/v1/apps/checknameavailable
</pre>
<pre class="highlight shell">curl <span class="s2">"http://api.carrotquest.io/v1/apps/checknameavailable?auth_token=XXX&amp;name=MySuperApp"</span>
</pre>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"available"</span><span class="p">:</span><span class="w"> </span><span class="kc">true</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>Проверяет, доступно ли имя для приложение (имена должны быть уникальными)</p>

<h3 id="Параметры">Параметры</h3>

<table><thead>
<tr>
<th>Название</th>
<th>Описание</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td><strong>обязательный</strong> Название приложения</td>
</tr>
</tbody></table>

<h3 id="Возаращаемое-значение">Возаращаемое значение</h3>

<p>Если имя доступно, то перемнная <code class="prettyprint">available</code> будет иметь значение <code class="prettyprint">true</code>; иначе - <code class="prettyprint">false</code></p>

          <h1 id="events">Events</h1>

<h2 id="Объект-event">Объект Event</h2>

<h2 id="Создать-событие">Создать событие</h2>
<pre class="highlight plaintext">POST http://api.carrotquest.io/v1/events
</pre>
<pre class="highlight shell">curl <span class="s2">"http://api.carrotquest.io/v1/events?auth_token=XXX"</span> <span class="se">\</span>
  -d <span class="s2">"event=My Event"</span> <span class="se">\</span>
  -d <span class="s2">"app=</span><span class="nv">$self_app</span><span class="s2">"</span> <span class="se">\</span>
  -d <span class="s2">"user=</span><span class="nv">$self_user</span><span class="s2">"</span>
</pre>
<pre class="highlight json"><span class="p">{</span><span class="w">
  </span><span class="s2">"data"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"carrots"</span><span class="p">:</span><span class="w"> </span><span class="mi">15</span><span class="w">
  </span><span class="p">},</span><span class="w">
  </span><span class="s2">"meta"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="s2">"status"</span><span class="p">:</span><span class="w"> </span><span class="mi">200</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre>

<p>Создает новое событие (трекинг). К событию может быть привязан объект (но необязательно). </p>

<p>Объекты могут быть разных типов. Самый частый тип &ndash; товар в интернет-магазине. Поэтому
зарегистрирован системный тип &ndash; <code class="prettyprint">$product</code>. Если есть товары, то нужно использовать его.
Своих типов можно создавать сколько угодно.</p>

<p>Имя события может быть любым, не начинающимся с символа $.
Зарезервированные системные события: </p>

<table><thead>
<tr>
<th>Название</th>
<th>Описание</th>
</tr>
</thead><tbody>
<tr>
<td>$basket_add</td>
<td>Добавил товар в корзину</td>
</tr>
<tr>
<td>$purchase</td>
<td>Покупка (заказ состоит из нескольких покупок, каждый отдельный товар в заказе - это отдельная покупка)</td>
</tr>
<tr>
<td>$order</td>
<td>Сделал заказ</td>
</tr>
<tr>
<td>$product_view</td>
<td>Просмотрел товар</td>
</tr>
<tr>
<td>$session_start</td>
<td>Начал сессию</td>
</tr>
<tr>
<td>$message_sended</td>
<td>Отправлено сообщение</td>
</tr>
<tr>
<td>$share</td>
<td>Рассказал друзьям</td>
</tr>
<tr>
<td>$registered</td>
<td>Зарегистрировался в CarrotQuest</td>
</tr>
</tbody></table>

<h3 id="Параметры">Параметры</h3>

<table><thead>
<tr>
<th>Название</th>
<th>Описание</th>
</tr>
</thead><tbody>
<tr>
<td>name</td>
<td><strong>обязательный</strong> Название события</td>
</tr>
<tr>
<td>app</td>
<td><strong>обязательный</strong> ID приложения</td>
</tr>
<tr>
<td>user</td>
<td><strong>обязательный</strong> ID пользователя</td>
</tr>
<tr>
<td>object_type</td>
<td>Тип объекта</td>
</tr>
<tr>
<td>object_name</td>
<td>Имя объекта</td>
</tr>
<tr>
<td>object_id</td>
<td>ID объекта</td>
</tr>
<tr>
<td>object_url</td>
<td>URL объекта</td>
</tr>
</tbody></table>

<h3 id="Вовзращаемое-значение">Вовзращаемое значение</h3>

<p>В случае успеха, в перменной <code class="prettyprint">carrots</code> возвращается количество морковок у пользователя,
который совершил событие.</p>

      </div>
      <div class="dark-box">
          <div id="lang-selector">
                <a href="#" data-language-name="shell">shell</a>
          </div>
      </div>
    </div>
  </body>
</html>
